!function(a,b,c){"use strict";a.CMB={formfield:"",iterator:0,file_frames:{},init:function(){CMB.log(a.cmb_l10),a.cmb_l10.new_admin_style&&c(".cmb-spinner img").hide(),c(".cmb_timepicker").each(function(){c("#"+jQuery(this).attr("id")).timePicker({startTime:"07:00",endTime:"22:00",show24Hours:!1,separator:":",step:30})}),c(".cmb_datepicker").each(function(){c("#"+jQuery(this).attr("id")).datepicker({dateFormat:"D, dd/mm/yy"})}),c("#ui-datepicker-div").wrap('<div class="cmb_element" />'),"object"==typeof jQuery.wp&&"function"==typeof jQuery.wp.wpColorPicker?c("input:text.cmb_colorpicker").wpColorPicker():c("input:text.cmb_colorpicker").each(function(a){c(this).after('<div id="picker-'+a+'" style="z-index: 1000; background: #EEE; border: 1px solid #CCC; position: absolute; display: block;"></div>'),c("#picker-"+a).hide().farbtastic(c(this))}).focus(function(){c(this).next().show()}).blur(function(){c(this).next().hide()}),c(".cmb_metabox").on("change",".cmb_upload_file",function(){CMB.formfield=c(this).attr("name"),c("#"+CMB.formfield+"_id").val("")}).on("click",".cmb_upload_button",function(b){b.preventDefault();var d=c(this);CMB.formfield=d.prev("input").attr("name");var e=c("#"+CMB.formfield),f=!0,g=!0,h=d.hasClass("cmb_upload_list");return CMB.formfield in CMB.file_frames?(CMB.file_frames[CMB.formfield].open(),void 0):(CMB.file_frames[CMB.formfield]=wp.media.frames.file_frame=wp.media({title:c("label[for="+CMB.formfield+"]").text(),button:{text:a.cmb_l10.upload_file},multiple:h?!0:!1}),CMB.file_frames[CMB.formfield].on("select",function(){if(h){g=CMB.file_frames[CMB.formfield].state().get("selection").toJSON(),e.val(g.url),c("#"+CMB.formfield+"_id").val(g.id);var a=[];c(g).each(function(){f=this.type&&"image"===this.type?'<li class="img_status"><img width="50" height="50" src="'+this.url+'" class="attachment-50x50" alt="'+this.filename+'">'+'<p><a href="#" class="cmb_remove_file_button" rel="'+CMB.formfield+"["+this.id+']">'+cmb_l10.remove_image+"</a></p>"+'<input type="hidden" id="filelist-'+this.id+'" name="'+CMB.formfield+"["+this.id+']" value="'+this.url+'">'+"</li>":"<li>"+cmb_l10.file+" <strong>"+this.filename+'</strong>&nbsp;&nbsp;&nbsp; (<a href="'+this.url+'" target="_blank" rel="external">'+cmb_l10.download+'</a> / <a href="#" class="cmb_remove_file_button" rel="'+CMB.formfield+"["+this.id+']">'+cmb_l10.remove_file+"</a>)"+'<input type="hidden" id="filelist-'+this.id+'" name="'+CMB.formfield+"["+this.id+']" value="'+this.url+'">'+"</li>",a.push(f)}),c(a).each(function(){e.siblings(".cmb_media_status").slideDown().append(this)})}else g=CMB.file_frames[CMB.formfield].state().get("selection").first().toJSON(),e.val(g.url),c("#"+CMB.formfield+"_id").val(g.id),f=g.type&&"image"===g.type?'<div class="img_status"><img style="max-width: 350px; width: 100%; height: auto;" src="'+g.url+'" alt="'+g.filename+'" title="'+g.filename+'" /><p><a href="#" class="cmb_remove_file_button" rel="'+CMB.formfield+'">'+cmb_l10.remove_image+"</a></p></div>":cmb_l10.file+" <strong>"+g.filename+'</strong>&nbsp;&nbsp;&nbsp; (<a href="'+g.url+'" target="_blank" rel="external">'+cmb_l10.download+'</a> / <a href="#" class="cmb_remove_file_button" rel="'+CMB.formfield+'">'+cmb_l10.remove_file+"</a>)",e.siblings(".cmb_media_status").slideDown().html(f)}),CMB.file_frames[CMB.formfield].open(),void 0)}).on("click",".cmb_remove_file_button",function(){var b=c(this);if(b.is(".attach_list .cmb_remove_file_button"))return b.parents("li").remove(),!1;CMB.formfield=b.attr("rel");var d=b.parents(".img_status");return c("input#"+CMB.formfield).val(""),c("input#"+CMB.formfield+"_id").val(""),d.length?d.html(""):b.parents(".cmb_media_status").html(""),!1}).on("click",".add-row-button",function(a){a.preventDefault();var b=c(this),d="#"+b.data("selector"),e=c(d),f=c(".empty-row",e).clone(!0);f.removeClass("empty-row").addClass("repeat-row"),f.insertBefore(d+" tbody>tr:last");var g=c("input.cmb_datepicker",f),h=g.attr("id");g.attr("id",h+CMB.iterator),CMB.iterator++}).on("click",".remove-row-button",function(a){a.preventDefault();var b=c(this),d=b.parents(".cmb-repeat-table");CMB.log("number of tbodys",d.length),CMB.log("number of trs",c("tr",d).length),c("tr",d).length>2&&b.parents(".cmb-repeat-table tr").remove()}).on("keyup",".cmb_oembed",function(a){CMB.doAjax(c(this),a)}),c(".cmb_oembed").bind("paste",function(){var b=c(this);setTimeout(function(){CMB.doAjax(b,"paste")},100)}).blur(function(){setTimeout(function(){CMB.spinner(".postbox table.cmb_metabox",!0)},2e3)}),setTimeout(CMB.resizeoEmbeds,500),c(a).on("resize",CMB.resizeoEmbeds)},log:function(){a.cmb_l10.script_debug&&console&&"function"==typeof console.log&&console.log.apply(console,arguments)},spinner:function(a,b){b?c(".cmb-spinner",a).hide():c(".cmb-spinner",a).show()},doAjax:function(b,d){var e=b.val();if(!(e.length<6)&&("paste"===d||d.which<=90&&d.which>=48||d.which>=96&&d.which<=111||8==d.which||9==d.which||187==d.which||190==d.which)){var f=b.attr("id"),g=b.parents(".cmb_metabox tr td"),h=c(".embed_status",g),i=b.width(),j=c(":first-child",h);i=h.length&&j.length?j.width():b.width(),CMB.spinner(g),c(".embed_wrap",g).html(""),setTimeout(function(){c(".cmb_oembed:focus").val()==e&&c.ajax({type:"post",dataType:"json",url:a.cmb_l10.ajaxurl,data:{action:"cmb_oembed_handler",oembed_url:e,oembed_width:i>300?i:300,field_id:f,object_id:b.data("objectid"),object_type:b.data("objecttype"),cmb_ajax_nonce:a.cmb_l10.ajax_nonce},success:function(a){CMB.log(a),"undefined"!=typeof a.id&&(CMB.spinner(g,!0),c(".embed_wrap",g).html(a.result))}})},500)}},resizeoEmbeds:function(){c("table.cmb_metabox").each(function(){var b=c(this),d=b.parents(".inside");if(!d.length)return!0;var e=d.width(),f=Math.round(.97*.82*e)-30;if(f>639)return!0;var g=c(".cmb-type-oembed .embed_status",b).children().first(),h=g.width(),i=g.height(),j=Math.round(f*i/h);g.width(f).height(j)})}},c(b).ready(CMB.init)}(window,document,jQuery);